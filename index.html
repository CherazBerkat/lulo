<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Only Us</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        overflow: hidden;
        font-family: "Poppins", "Nunito", system-ui, sans-serif;
        color: #fff;
        background: #000;
      }

      /* Cosmic background */
      .cosmos {
        position: fixed;
        inset: 0;
        background: radial-gradient(ellipse at bottom, #0a0e27 0%, #000 100%);
        overflow: hidden;
      }

      .stars {
        position: absolute;
        inset: 0;
        background-image: radial-gradient(
            2px 2px at 20px 30px,
            #eee,
            transparent
          ),
          radial-gradient(2px 2px at 60px 70px, #fff, transparent),
          radial-gradient(1px 1px at 50px 50px, #ddd, transparent),
          radial-gradient(1px 1px at 130px 80px, #fff, transparent),
          radial-gradient(2px 2px at 90px 10px, #fff, transparent);
        background-repeat: repeat;
        background-size: 200px 200px;
        animation: twinkle 8s ease-in-out infinite, drift 120s linear infinite;
        opacity: 0.7;
      }

      @keyframes twinkle {
        0%,
        100% {
          opacity: 0.7;
        }
        50% {
          opacity: 1;
        }
      }

      @keyframes drift {
        from {
          transform: translateY(0);
        }
        to {
          transform: translateY(-200px);
        }
      }

      /* Aurora effect */
      .aurora {
        position: absolute;
        inset: 0;
        background: radial-gradient(
            ellipse at 50% 0%,
            rgba(167, 139, 250, 0.15),
            transparent 50%
          ),
          radial-gradient(
            ellipse at 80% 50%,
            rgba(244, 114, 182, 0.1),
            transparent 50%
          ),
          radial-gradient(
            ellipse at 20% 80%,
            rgba(96, 165, 250, 0.12),
            transparent 50%
          );
        animation: aurora 15s ease-in-out infinite;
        filter: blur(60px);
      }

      @keyframes aurora {
        0%,
        100% {
          opacity: 0.3;
          transform: scale(1) translateY(0);
        }
        33% {
          opacity: 0.6;
          transform: scale(1.1) translateY(-20px);
        }
        66% {
          opacity: 0.4;
          transform: scale(0.95) translateY(20px);
        }
      }

      /* Mystical orbs */
      .orb {
        position: absolute;
        border-radius: 50%;
        filter: blur(40px);
        animation: float-orb 20s infinite ease-in-out;
        opacity: 0.3;
      }

      .orb:nth-child(1) {
        width: 300px;
        height: 300px;
        background: radial-gradient(
          circle,
          rgba(167, 139, 250, 0.4),
          transparent
        );
        top: 10%;
        left: 20%;
        animation-duration: 25s;
      }

      .orb:nth-child(2) {
        width: 400px;
        height: 400px;
        background: radial-gradient(
          circle,
          rgba(244, 114, 182, 0.3),
          transparent
        );
        bottom: 20%;
        right: 10%;
        animation-delay: -8s;
        animation-duration: 30s;
      }

      .orb:nth-child(3) {
        width: 250px;
        height: 250px;
        background: radial-gradient(
          circle,
          rgba(96, 165, 250, 0.35),
          transparent
        );
        top: 60%;
        left: 60%;
        animation-delay: -15s;
        animation-duration: 22s;
      }

      @keyframes float-orb {
        0%,
        100% {
          transform: translate(0, 0) scale(1);
        }
        25% {
          transform: translate(30px, -40px) scale(1.1);
        }
        50% {
          transform: translate(-20px, 30px) scale(0.9);
        }
        75% {
          transform: translate(40px, 20px) scale(1.05);
        }
      }

      /* Breathing particles */
      .particle-field {
        position: absolute;
        inset: 0;
        perspective: 1000px;
      }

      .breath-particle {
        position: absolute;
        width: 3px;
        height: 3px;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.9),
          transparent
        );
        border-radius: 50%;
        animation: breathe-float linear infinite;
      }

      @keyframes breathe-float {
        0% {
          transform: translateZ(0) translateY(100vh) scale(0);
          opacity: 0;
        }
        5% {
          opacity: 0.8;
        }
        50% {
          opacity: 1;
        }
        95% {
          opacity: 0.5;
        }
        100% {
          transform: translateZ(200px) translateY(-20vh) scale(1.5);
          opacity: 0;
        }
      }

      /* Scene viewer */
      #viewer {
        position: fixed;
        inset: 0;
        z-index: 10;
        opacity: 0;
        transition: opacity 2s ease;
        pointer-events: all;
      }

      #viewer.active {
        opacity: 1;
      }

      #viewer iframe {
        width: 100%;
        height: 100%;
        border: none;
        pointer-events: all;
      }

      /* Overlay system */
      .overlay {
        position: fixed;
        inset: 0;
        z-index: 20;
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(0px);
        transition: all 2s cubic-bezier(0.4, 0, 0.2, 1);
        pointer-events: all;
      }

      .overlay.hide {
        opacity: 0;
        pointer-events: none;
        backdrop-filter: blur(20px);
      }

      /* Sacred geometry */
      .geometry {
        position: absolute;
        width: 500px;
        height: 500px;
        opacity: 0;
        animation: geometry-reveal 3s ease-out forwards 0.5s;
      }

      @keyframes geometry-reveal {
        to {
          opacity: 0.15;
        }
      }

      .circle {
        position: absolute;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        top: 50%;
        left: 50%;
      }

      .circle:nth-child(1) {
        width: 100%;
        height: 100%;
        margin: -50% 0 0 -50%;
        animation: rotate 30s linear infinite;
      }

      .circle:nth-child(2) {
        width: 70%;
        height: 70%;
        margin: -35% 0 0 -35%;
        animation: rotate 25s linear infinite reverse;
      }

      .circle:nth-child(3) {
        width: 40%;
        height: 40%;
        margin: -20% 0 0 -20%;
        animation: rotate 20s linear infinite;
      }

      @keyframes rotate {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      /* Content container */
      .sanctuary {
        position: relative;
        text-align: center;
        z-index: 2;
        opacity: 0;
        animation: sanctuary-emerge 2.5s cubic-bezier(0.22, 1, 0.36, 1) forwards
          1s;
      }

      @keyframes sanctuary-emerge {
        from {
          opacity: 0;
          transform: translateY(60px) scale(0.9);
          filter: blur(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
          filter: blur(0);
        }
      }

      /* Message styling */
      h1 {
        font-size: clamp(1.5rem, 5vw, 3.5rem);
        font-weight: 200;
        letter-spacing: 0.05em;
        margin: 0;
        background: linear-gradient(135deg, #fff 0%, #f4b2d2 50%, #a78bfa 100%);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        filter: drop-shadow(0 0 40px rgba(244, 178, 210, 0.5));
        animation: text-shimmer 8s ease-in-out infinite;
        line-height: 1.4;
        padding: 0 1rem;
      }

      @keyframes text-shimmer {
        0%,
        100% {
          filter: drop-shadow(0 0 40px rgba(244, 178, 210, 0.5)) brightness(1);
        }
        50% {
          filter: drop-shadow(0 0 60px rgba(167, 139, 250, 0.7)) brightness(1.3);
        }
      }

      /* Poetic elements */
      .whisper {
        margin-top: 3rem;
        font-size: 0.85rem;
        font-weight: 300;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        opacity: 0;
        animation: whisper-in 2s ease forwards 3s;
        position: relative;
      }

      @keyframes whisper-in {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 0.7;
          transform: translateY(0);
        }
      }

      .whisper::before,
      .whisper::after {
        content: "✦";
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        animation: sparkle 3s ease-in-out infinite;
        opacity: 0.5;
      }

      .whisper::before {
        left: -2rem;
      }

      .whisper::after {
        right: -2rem;
        animation-delay: 1.5s;
      }

      @keyframes sparkle {
        0%,
        100% {
          opacity: 0.3;
          transform: translateY(-50%) scale(0.8);
        }
        50% {
          opacity: 1;
          transform: translateY(-50%) scale(1.2);
        }
      }

      /* Floating message overlay */
      .float-message {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 25;
        text-align: center;
        pointer-events: none;
        opacity: 0;
        transition: opacity 1.5s ease, transform 1.5s ease, filter 1.5s ease;
      }

      .float-message.show {
        opacity: 1;
        transform: translate(-50%, -55%);
        filter: blur(0);
      }

      .float-message h2 {
        font-size: clamp(1.2rem, 4vw, 2.5rem);
        font-weight: 300;
        letter-spacing: 0.1em;
        color: #fff;
        text-shadow: 0 0 30px rgba(244, 178, 210, 0.8),
          0 0 60px rgba(167, 139, 250, 0.6);
        margin: 0;
      }

      /* Navigation hints */
      .nav-hint {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 30;
        font-size: 0.75rem;
        font-weight: 300;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: rgba(255, 255, 255, 0.9);
        text-align: center;
        opacity: 0;
        transition: opacity 1s ease;
        pointer-events: none;
        text-shadow: 0 0 20px rgba(244, 178, 210, 0.8),
          0 0 40px rgba(244, 178, 210, 0.5);
        padding: 1rem 2rem;
        background: rgba(244, 178, 210, 0.1);
        border: 1px solid rgba(244, 178, 210, 0.3);
        border-radius: 50px;
        backdrop-filter: blur(10px);
        cursor: pointer;
      }

      .nav-hint.show {
        opacity: 1;
        pointer-events: all;
        animation: gentle-pulse 3s ease-in-out infinite;
      }

      .nav-hint:hover {
        background: rgba(244, 178, 210, 0.2);
        border-color: rgba(244, 178, 210, 0.5);
        transform: translateX(-50%) translateY(-3px);
        box-shadow: 0 8px 30px rgba(244, 178, 210, 0.4);
      }

      @keyframes gentle-pulse {
        0%,
        100% {
          opacity: 0.8;
          transform: translateX(-50%) translateY(0);
        }
        50% {
          opacity: 1;
          transform: translateX(-50%) translateY(-5px);
        }
      }

      /* Cursor glow */
      .cursor-glow {
        position: fixed;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: radial-gradient(
          circle,
          rgba(244, 178, 210, 0.6),
          transparent
        );
        pointer-events: none;
        z-index: 35;
        filter: blur(10px);
        transition: transform 0.15s ease;
        opacity: 0;
      }

      /* Finish button */
      .finish-button {
        position: fixed;
        bottom: 40px;
        right: 40px;
        z-index: 30;
        padding: 1rem 2.5rem;
        font-family: inherit;
        font-size: 0.85rem;
        font-weight: 300;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: #fff;
        background: rgba(244, 178, 210, 0.15);
        border: 1px solid rgba(244, 178, 210, 0.4);
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.4s ease;
        backdrop-filter: blur(15px);
        overflow: hidden;
        opacity: 0;
        transform: translateY(20px);
        pointer-events: none;
        box-shadow: 0 4px 20px rgba(244, 178, 210, 0.2);
      }

      .finish-button.show {
        opacity: 1;
        transform: translateY(0);
        pointer-events: all;
        animation: button-glow 3s ease-in-out infinite;
      }

      @keyframes button-glow {
        0%,
        100% {
          box-shadow: 0 4px 20px rgba(244, 178, 210, 0.2);
        }
        50% {
          box-shadow: 0 4px 30px rgba(244, 178, 210, 0.4),
            0 0 40px rgba(167, 139, 250, 0.3);
        }
      }

      .finish-button::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          135deg,
          rgba(244, 178, 210, 0.3),
          rgba(167, 139, 250, 0.3)
        );
        opacity: 0;
        transition: opacity 0.4s ease;
      }

      .finish-button:hover {
        transform: translateY(-3px);
        border-color: rgba(244, 178, 210, 0.7);
        box-shadow: 0 8px 40px rgba(244, 178, 210, 0.4),
          0 0 60px rgba(167, 139, 250, 0.3);
      }

      .finish-button:hover::before {
        opacity: 1;
      }

      .finish-button span {
        position: relative;
        z-index: 1;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      /* Closing scene */
      .closing-scene {
        position: fixed;
        inset: 0;
        z-index: 50;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 2s ease;
      }

      .closing-scene.show {
        opacity: 1;
        pointer-events: all;
      }

      .closing-message {
        text-align: center;
        margin-bottom: 4rem;
      }

      .closing-message h2 {
        font-size: clamp(1.8rem, 5vw, 3.5rem);
        font-weight: 200;
        letter-spacing: 0.08em;
        margin: 0 0 1.5rem 0;
        background: linear-gradient(135deg, #fff 0%, #f4b2d2 50%, #a78bfa 100%);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        filter: drop-shadow(0 0 40px rgba(244, 178, 210, 0.5));
        animation: text-shimmer 8s ease-in-out infinite;
        line-height: 1.4;
        padding: 0 1rem;
      }

      .closing-message p {
        font-size: clamp(0.9rem, 2.5vw, 1.2rem);
        font-weight: 300;
        letter-spacing: 0.15em;
        color: rgba(255, 255, 255, 0.7);
        margin: 0;
        line-height: 1.8;
      }

      .restart-button {
        padding: 1rem 3rem;
        font-family: inherit;
        font-size: 0.9rem;
        font-weight: 300;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: #fff;
        background: rgba(244, 178, 210, 0.1);
        border: 1px solid rgba(244, 178, 210, 0.3);
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.4s ease;
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
      }

      .restart-button::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          135deg,
          rgba(244, 178, 210, 0.2),
          rgba(167, 139, 250, 0.2)
        );
        opacity: 0;
        transition: opacity 0.4s ease;
      }

      .restart-button:hover {
        transform: translateY(-2px);
        border-color: rgba(244, 178, 210, 0.6);
        box-shadow: 0 10px 40px rgba(244, 178, 210, 0.3);
      }

      .restart-button:hover::before {
        opacity: 1;
      }

      .restart-button span {
        position: relative;
        z-index: 1;
      }

      /* Fade transitions */
      .fade-out {
        animation: sanctuary-fade 2s ease-out forwards !important;
      }

      @keyframes sanctuary-fade {
        to {
          opacity: 0;
          transform: scale(1.1);
          filter: blur(30px);
        }
      }

      /* Click wave */
      .wave {
        position: fixed;
        border-radius: 50%;
        border: 2px solid rgba(244, 178, 210, 0.6);
        animation: wave-expand 1.5s ease-out;
        pointer-events: none;
      }

      @keyframes wave-expand {
        from {
          width: 0;
          height: 0;
          opacity: 0.8;
        }
        to {
          width: 1000px;
          height: 1000px;
          opacity: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="cosmos">
      <div class="stars"></div>
      <div class="aurora"></div>
      <div class="orb"></div>
      <div class="orb"></div>
      <div class="orb"></div>
      <div class="particle-field" id="particles"></div>
    </div>

    <div class="cursor-glow" id="cursorGlow"></div>

    <div class="overlay" id="overlay">
      <div class="geometry">
        <div class="circle"></div>
        <div class="circle"></div>
        <div class="circle"></div>
      </div>

      <div class="sanctuary">
        <h1 id="message">Hey Lulo, it's safe here for a bit.</h1>
        <div class="whisper">tap to begin</div>
      </div>
    </div>

    <div class="float-message" id="floatMessage">
      <h2></h2>
    </div>

    <div id="viewer"></div>

    <div class="nav-hint" id="navHint">tap to continue</div>

    <button class="finish-button" id="finishBtn">
      <span>✦ Continue ✦</span>
    </button>

    <div class="closing-scene" id="closingScene">
      <div class="closing-message">
        <h2>Thank you for being here, Lulo</h2>
        <p>This space is always yours.<br />Whenever you need it.</p>
      </div>
      <button class="restart-button" id="restartBtn">
        <span>✦ Return to the beginning ✦</span>
      </button>
    </div>

    <script>
      // Scene configuration
      const scenes = [
        {
          path: "1/index.html",
          name: "Heart Particles",
          showNavHint: true,
          hint: "tap to continue",
        },
        {
          path: "2/index.html",
          name: "Physics Hearts",
          showNavHint: true,
          hint: "tap to continue",
        },
        {
          path: "3/index.html",
          name: "Blooming Flowers",
          isInteractive: true,
          autoAdvanceDuration: 15000,
          transitionMessage: "Now you can make your own flowers ✿",
        },
        {
          path: "4/index.html",
          name: "Enchanted Garden",
          isInteractive: true,
          isFinalScene: true,
        },
      ];

      const welcomeMessages = [
        "Hey Lulo,",
        "It's just us again, Lucioleau ✨",
        "I'm glad you're here, little light.",
        "Only us, in our quiet corner of the sky.",
        "Soft place, soft heart, my soft you.",
      ];

      // State
      let currentScene = -1;
      let sceneTimeout = null;
      let canProgress = false;

      // Initialize
      function init() {
        createBreathingParticles();
        setupCursorGlow();

        document.getElementById("message").textContent =
          welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];

        document.body.addEventListener("click", handleInitialClick);
      }

      function createBreathingParticles() {
        const field = document.getElementById("particles");
        for (let i = 0; i < 40; i++) {
          const particle = document.createElement("div");
          particle.className = "breath-particle";
          particle.style.left = Math.random() * 100 + "%";
          particle.style.animationDuration = Math.random() * 8 + 6 + "s";
          particle.style.animationDelay = Math.random() * 5 + "s";
          field.appendChild(particle);
        }
      }

      function setupCursorGlow() {
        const glow = document.getElementById("cursorGlow");
        document.addEventListener("mousemove", (e) => {
          glow.style.opacity = "1";
          glow.style.left = e.clientX - 10 + "px";
          glow.style.top = e.clientY - 10 + "px";
        });
      }

      function createWave(e) {
        const wave = document.createElement("div");
        wave.className = "wave";
        wave.style.left = e.clientX + "px";
        wave.style.top = e.clientY + "px";
        wave.style.transform = "translate(-50%, -50%)";
        wave.style.zIndex = "25";
        document.body.appendChild(wave);
        setTimeout(() => wave.remove(), 1500);
      }

      function showFloatingMessage(text, duration = 3000) {
        const msg = document.getElementById("floatMessage");
        msg.querySelector("h2").textContent = text;
        msg.classList.add("show");

        setTimeout(() => {
          msg.classList.remove("show");
        }, duration);
      }

      function loadScene(index) {
        if (index >= scenes.length) return;

        const scene = scenes[index];
        const viewer = document.getElementById("viewer");

        console.log(
          "Loading scene:",
          scene.name,
          "Interactive:",
          scene.isInteractive,
          "Final:",
          scene.isFinalScene
        );

        // Clear any existing timeout to prevent double-firing
        if (sceneTimeout) {
          console.log("Clearing existing scene timeout");
          clearTimeout(sceneTimeout);
          sceneTimeout = null;
        }

        const iframe = document.createElement("iframe");
        iframe.src = scene.path;
        iframe.style.opacity = "0";
        iframe.style.transition = "opacity 2s ease";

        let hasLoaded = false; // Prevent double onload calls

        iframe.onerror = () => {
          console.error("Failed to load iframe:", scene.path);
        };

        iframe.onload = () => {
          if (hasLoaded) {
            console.log("Ignoring duplicate onload for:", scene.name);
            return;
          }
          hasLoaded = true;

          console.log("Iframe loaded successfully:", scene.name);

          setTimeout(() => {
            iframe.style.opacity = "1";
            viewer.classList.add("active");

            // Show nav hint if needed
            if (scene.showNavHint && scene.hint) {
              const navHint = document.getElementById("navHint");
              navHint.textContent = scene.hint;
              setTimeout(() => {
                navHint.classList.add("show");
                canProgress = true;
              }, 3000);
            }

            if (scene.autoAdvanceDuration) {
              console.log(
                "Setting auto-advance timer for",
                scene.autoAdvanceDuration,
                "ms"
              );
              sceneTimeout = setTimeout(() => {
                console.log("Auto-advance timer fired");
                autoAdvanceToNext();
              }, scene.autoAdvanceDuration);
            }

            if (scene.isFinalScene) {
              console.log("Final scene - will show finish button in 5s");
              setTimeout(() => {
                console.log("Showing finish button");
                document.getElementById("finishBtn").classList.add("show");
              }, 5000);
            }
          }, 100);
        };

        viewer.innerHTML = "";
        viewer.appendChild(iframe);
      }

      function autoAdvanceToNext() {
        const scene = scenes[currentScene];

        console.log("Auto-advancing from scene:", scene.name);

        if (scene.transitionMessage) {
          showFloatingMessage(scene.transitionMessage, 3000);
        }

        const viewer = document.getElementById("viewer");
        viewer.style.transition = "opacity 2s ease";
        viewer.style.opacity = "0";

        document.getElementById("navHint").classList.remove("show");

        setTimeout(() => {
          // Clear the old scene content before moving to next
          viewer.innerHTML = "";
          viewer.classList.remove("active");

          // Now move to next scene
          currentScene++;
          canProgress = false;

          console.log("After auto-advance, currentScene is now:", currentScene);

          if (currentScene >= scenes.length) {
            console.log("Reached end after auto-advance");
            showClosingScene();
            return;
          }

          console.log(
            "Loading scene after auto-advance:",
            scenes[currentScene].name
          );

          // Reset opacity for new scene
          viewer.style.opacity = "1";

          if (sceneTimeout) {
            clearTimeout(sceneTimeout);
            sceneTimeout = null;
          }

          setTimeout(() => {
            loadScene(currentScene);
          }, 500);
        }, 2000);
      }

      function nextScene() {
        console.log(
          "nextScene called - current:",
          currentScene,
          "moving to:",
          currentScene + 1
        );

        currentScene++;
        canProgress = false;

        // Check if we've reached the end (after scene 4, which is index 3)
        if (currentScene >= scenes.length) {
          console.log("Past all scenes, showing closing");
          showClosingScene();
          return;
        }

        console.log("Loading next scene:", scenes[currentScene].name);

        const viewer = document.getElementById("viewer");
        viewer.style.opacity = "1";
        viewer.classList.remove("active");
        document.getElementById("navHint").classList.remove("show");

        if (sceneTimeout) {
          clearTimeout(sceneTimeout);
          sceneTimeout = null;
        }

        setTimeout(() => {
          loadScene(currentScene);
        }, 500);
      }

      function showClosingScene() {
        const viewer = document.getElementById("viewer");
        viewer.style.opacity = "0";
        viewer.classList.remove("active");
        document.getElementById("navHint").classList.remove("show");
        document.getElementById("finishBtn").classList.remove("show");

        setTimeout(() => {
          viewer.innerHTML = "";
          const closingScene = document.getElementById("closingScene");
          closingScene.classList.add("show");
        }, 2000);
      }

      function restartExperience() {
        const closingScene = document.getElementById("closingScene");
        closingScene.classList.remove("show");

        setTimeout(() => {
          currentScene = -1;
          canProgress = false;

          const overlay = document.getElementById("overlay");
          overlay.classList.remove("hide");

          const viewer = document.getElementById("viewer");
          viewer.style.opacity = "0";
          viewer.innerHTML = "";
          viewer.classList.remove("active");

          document.getElementById("finishBtn").classList.remove("show");
          document.getElementById("navHint").classList.remove("show");

          const sanctuary = overlay.querySelector(".sanctuary");
          sanctuary.classList.remove("fade-out");
          sanctuary.style.animation = "none";
          setTimeout(() => {
            sanctuary.style.animation = "";
          }, 10);

          document.getElementById("message").textContent =
            welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];

          document.body.addEventListener("click", handleInitialClick);
        }, 1000);
      }

      function handleNavHintClick(e) {
        e.stopPropagation();
        createWave(e);

        if (!canProgress) {
          return;
        }

        const confirmMessages = [
          "Taking you forward, Lulo...",
          "Moving to the next moment...",
          "Let's continue together...",
        ];
        showFloatingMessage(
          confirmMessages[Math.floor(Math.random() * confirmMessages.length)],
          1500
        );

        canProgress = false;
        setTimeout(() => nextScene(), 1000);
      }

      function handleInitialClick(e) {
        createWave(e);

        if (currentScene === -1) {
          const overlay = document.getElementById("overlay");
          const sanctuary = overlay.querySelector(".sanctuary");
          sanctuary.classList.add("fade-out");

          setTimeout(() => {
            overlay.classList.add("hide");
            nextScene();
          }, 1500);

          document.body.removeEventListener("click", handleInitialClick);
        }
      }

      function handleFinishClick(e) {
        e.stopPropagation();
        console.log("Finish button clicked");
        createWave(e);
        showFloatingMessage("Thank you for creating with me, Lulo ✿", 2000);

        // Hide the button immediately
        document.getElementById("finishBtn").classList.remove("show");

        setTimeout(() => {
          console.log("Moving to closing scene from finish button");
          showClosingScene();
        }, 2000);
      }

      // Start
      init();

      // Setup nav hint click handler
      document
        .getElementById("navHint")
        .addEventListener("click", handleNavHintClick);

      // Setup finish button
      document
        .getElementById("finishBtn")
        .addEventListener("click", handleFinishClick);

      // Setup restart button
      document.getElementById("restartBtn").addEventListener("click", (e) => {
        createWave(e);
        restartExperience();
      });
    </script>
  </body>
</html>
